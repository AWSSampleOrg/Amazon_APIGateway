# AWS環境にカスタムドメインを設定する例

## 1. ドメインを取得
  - 参考)Freenomというサイトで無料で取得できる。Route53でも取得できるが有料。ただし、Freenomで取得した場合、有効期限がある。

## 2. Route53にドメインを登録
  - 2-1. Host Zoneを作成。1. で取得したドメインを指定。
  - 2-2. NSレコードとSOAレコードが自動作成されていることを確認する。

## 3. 2.で登録されたNSレコードの値を、「Domain Server」として登録
  - ex) 1.でFreenomを使った場合、FreenomでNameServerにNSレコードの値を1つずつ入力（普通4つある）。

## 4. ACM(AWS Certificate Manager)でSSL/TLS証明書を発行
  - 4-1. 以下5で作成するカスタムドメインのエンドポイントを「Edge-optimized API」とする場合はVirginia北部で、
    Regional API」とする場合は、該当するRegionで発行する。
  - 4-2. 証明書を発行すると、「Route53でのレコードの作成」ボタンが表示されるので、作成する。
  - 4-3. 2. で作成したRoute53のHost ZoneにCNAMEレコードが作成されている事を確認する。
  - 4-4. 発行済みになるまで待つ。

## 5. APIGatewayでカスタムドメインを作成
```
プロトコル : REST
ドメイン名 : 1. で取得したドメイン名
セキュリティーポリシー : TLSv1.2
エンドポイント : 4. で発行した証明書に合わせて「Edge-optimized API」、「Regional API」を選択
ACM証明書 : 4. で取得した証明書

保存してベースマッピングを追加
送信先 : APIGatewayのAPI名
ステージ : ステージ名
パス : 今回は必要なし
```

## 6. Route53でAレコード作成
  - 6-1. 2. で作成したHost ZoneでAレコードを選択。
  - 6-2. エイリアスを選択し、5. でカスタムドメインに自動作成された「ターゲット名」を選択し、エイリアス先に追加。
  - 6-3. 2. で作成したHost ZoneにAレコード（エイリアス）が追加されていることを確認する。

## 7. 動作確認
```
~$ sslscan 1.で取得したドメイン/パス

    Supported Server Cipher
    Accepted TLSv1.2 128 bits 暗号化方法......

    ここにTLSv1.0が書かれていないことを確認する。
```
